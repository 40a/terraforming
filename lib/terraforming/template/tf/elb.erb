<% data['LoadBalancerDescriptions'].each do |load_balancer| %>
resource "aws_elb" "<%= load_balancer['LoadBalancerName'] %>" {
    name               = "<%= load_balancer['LoadBalancerName'] %>"
    availability_zones = <%= load_balancer['AvailabilityZones'].inspect %>
    subnets            = <%= load_balancer['Subnets'].inspect %>
    security_groups    = <%= load_balancer['SecurityGroups'].inspect %>
    instances          = <%= load_balancer['Instances'].map { |instance| instance['InstanceId'] }.inspect %>

<% load_balancer['ListenerDescriptions'].map { |ld| ld['Listener'] }.map do |listener| %>
    listener {
        instance_port      = <%= listener['InstancePort'] %>
        instance_protocol  = "<%= listener['InstanceProtocol'].downcase %>"
        lb_port            = <%= listener['LoadBalancerPort'] %>
        lb_protocol        = "<%= listener['Protocol'].downcase %>"
        ssl_certificate_id = "<%= listener['SSLCertificateId'] %>"
    }
<% end %>

    health_check {
        healthy_threshold   = <%= load_balancer['HealthCheck']['HealthyThreshold'] %>
        unhealthy_threshold = <%= load_balancer['HealthCheck']['UnhealthyThreshold'] %>
        interval            = <%= load_balancer['HealthCheck']['Interval'] %>
        target              = "<%= load_balancer['HealthCheck']['Target'] %>"
        timeout             = <%= load_balancer['HealthCheck']['Timeout'] %>
    }
}
<% end %>
